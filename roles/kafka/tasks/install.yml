---

- name: Include vars
  include_vars:
    file: main.yml
    name: main

- name: Unarchive the kafka bin that needs to be downloaded
  unarchive:
    src: https://mirrors.tuna.tsinghua.edu.cn/apache/kafka/3.0.0/kafka_2.13-3.0.0.tgz
    dest: /opt/
    remote_src: yes
    validate_certs: no
    list_files: yes
  register: archive_contents

- name: Move to kafka
  command: mv /opt/{{ archive_contents.files[0].split('/')[0] }} /opt/kafka

- name: Create the config file
  template:
    src: server.properties.j2
    dest: /opt/kafka/config/server.properties

- name: start kafka
  shell: 'nohup /opt/kafka/bin/kafka-server-start.sh /opt/kafka/config/server.properties >/dev/null 2>&1 &'
